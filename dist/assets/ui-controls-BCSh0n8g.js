class r{constructor(){this.audioContext=null,this.source=null,this.analyser=null,this.audioBuffer=null,this.startTime=0,this.pauseTime=0,this._isPlaying=!1,this.frequencyData=null}async loadFile(t){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioBuffer=await this.audioContext.decodeAudioData(t),this.analyser||(this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.connect(this.audioContext.destination),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount)),console.log(`Audio decoded: ${this.audioBuffer.duration.toFixed(2)}s`)}async loadFromAudioBuffer(t){this.audioBuffer=t,this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.analyser||(this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.connect(this.audioContext.destination),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount)),console.log(`Audio loaded: ${t.duration.toFixed(2)}s, ${t.sampleRate}Hz, ${t.numberOfChannels}ch`)}play(){if(!this.audioBuffer)return;this.source&&this.source.stop(),this.source=this.audioContext.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.connect(this.analyser);const t=this.pauseTime;this.source.start(0,t),this.startTime=this.audioContext.currentTime-t,this._isPlaying=!0,this.source.onended=()=>{this._isPlaying&&(this._isPlaying=!1,this.pauseTime=0)}}pause(){!this.source||!this._isPlaying||(this.pauseTime=this.audioContext.currentTime-this.startTime,this.source.stop(),this._isPlaying=!1)}stop(){this.source&&(this.source.stop(),this.pauseTime=0,this._isPlaying=!1)}getFrequencyData(){return this.analyser?(this.analyser.getByteFrequencyData(this.frequencyData),this.frequencyData):null}isPlaying(){return this._isPlaying}getCurrentTime(){return this._isPlaying?this.audioContext.currentTime-this.startTime:this.pauseTime}}class u{constructor(t){this.app=t,this.init()}init(){document.getElementById("fft-size").addEventListener("change",i=>{const e=parseInt(i.target.value);this.app.audioPlayer&&this.app.audioPlayer.analyser&&(this.app.audioPlayer.analyser.fftSize=e,this.app.audioPlayer.frequencyData=new Uint8Array(this.app.audioPlayer.analyser.frequencyBinCount),console.log(`FFT size changed to: ${e}`))}),document.getElementById("color-scheme").addEventListener("change",i=>{const e=i.target.value;this.app.visualizer&&this.app.visualizer.setColorScheme(e)});const a=document.getElementById("sensitivity"),n=document.getElementById("sensitivity-value");a.addEventListener("input",i=>{const e=parseFloat(i.target.value);n.textContent=e.toFixed(1),this.app.visualizer&&this.app.visualizer.setSensitivity(e)})}}export{r as A,u as U};
