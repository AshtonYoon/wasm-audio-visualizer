var h=Object.defineProperty;var m=(a,e,t)=>e in a?h(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var l=(a,e,t)=>m(a,typeof e!="symbol"?e+"":e,t);import{V as y,P as f}from"./performance-monitor-C4boWBfy.js";import{A as g,U as P}from"./ui-controls-BCSh0n8g.js";class u{constructor(){l(this,"animate",()=>{if(requestAnimationFrame(this.animate),this.performanceMonitor.beginFrame(),this.visualizer&&this.visualizer.render(),this.audioPlayer&&this.audioPlayer.isPlaying()){this.performanceMonitor.beginFFT();const e=this.audioPlayer.getFrequencyData();this.performanceMonitor.endFFT(),e&&this.visualizer&&this.visualizer.updateFrequency(e)}this.performanceMonitor.endFrame()});this.audioPlayer=null,this.visualizer=null,this.uiControls=null,this.performanceMonitor=null}async init(){try{document.getElementById("loading").classList.add("active"),this.updateStatus("Initializing Pure JavaScript visualizer..."),this.audioPlayer=new g,this.visualizer=new y("canvas-container"),this.uiControls=new P(this),this.performanceMonitor=new f,this.setupEventListeners(),document.getElementById("loading").classList.remove("active"),this.updateStatus("Ready. Load an audio file to begin."),console.log("Pure JavaScript visualizer initialized successfully")}catch(e){console.error("Failed to initialize app:",e),this.updateStatus("Error: Failed to initialize visualizer. Check console for details.")}}setupEventListeners(){document.getElementById("audio-file").addEventListener("change",t=>this.handleFileSelect(t)),document.getElementById("play-btn").addEventListener("click",()=>this.play()),document.getElementById("pause-btn").addEventListener("click",()=>this.pause()),document.getElementById("stop-btn").addEventListener("click",()=>this.stop()),this.animate()}async handleFileSelect(e){const t=e.target.files[0];if(t)try{this.updateStatus(`Loading ${t.name}...`),console.log(`Loading file: ${t.name}, type: ${t.type}, size: ${t.size} bytes`);const o=performance.now(),n=await t.arrayBuffer();console.log(`ArrayBuffer loaded, size: ${n.byteLength} bytes`),this.audioPlayer.audioContext||(this.audioPlayer.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.updateStatus(`Decoding ${t.name}...`),console.log("Decoding with Web Audio API...");let i;try{i=await this.audioPlayer.audioContext.decodeAudioData(n.slice(0))}catch(p){throw console.error("Web Audio API decode error:",p),new Error(`Failed to decode ${t.name}. Format may not be supported by your browser.`)}const s=performance.now()-o;console.log(`âœ“ Decoded: ${t.name}, ${i.duration.toFixed(2)}s, ${i.sampleRate}Hz, ${i.numberOfChannels}ch`),console.log(`Load time: ${s.toFixed(2)}ms`);const c=i.length,r=i.sampleRate,d=i.numberOfChannels;console.log(`Audio info: ${c} samples, ${r} Hz, ${d} ch`),await this.audioPlayer.loadFromAudioBuffer(i),document.getElementById("play-btn").disabled=!1,document.getElementById("pause-btn").disabled=!1,document.getElementById("stop-btn").disabled=!1,this.updateStatus(`Loaded: ${t.name} (${r} Hz, ${d}ch, ${s.toFixed(0)}ms)`)}catch(o){console.error("Error loading file:",o),this.updateStatus(`Error: ${o.message}`)}}play(){this.audioPlayer&&(this.audioPlayer.play(),this.updateStatus("Playing..."),this.performanceMonitor.start())}pause(){this.audioPlayer&&(this.audioPlayer.pause(),this.updateStatus("Paused"),this.performanceMonitor.pause())}stop(){this.audioPlayer&&(this.audioPlayer.stop(),this.updateStatus("Stopped"),this.performanceMonitor.stop())}updateStatus(e){document.getElementById("status").textContent=e}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new u().init()}):new u().init();
